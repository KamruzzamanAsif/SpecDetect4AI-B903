# Smell: Merge API Parameter Not Explicitly Set

## Motivation  

`pd.DataFrame.merge()` is a powerful but **explicit** join primitive.  When the
key columns are **not specified** `(on=, left_on= / right_on=)` pandas
falls back to the intersection of column names.

Why this hurts:

it is **implicit** – one extra identically‑named column sneaking into either
side silently changes the join result;

the behaviour diverges from SQL, leading to surprising Cartesian products or
dropped rows;

reviewing or refactoring the code later requires mentally inferring the join
keys.

Declaring the join columns upfront `(orders.merge(customers, on="customer_id")`  makes the intent crystal‑clear and future‑proof.

---

## Detection strategy (high‑level view)

1. **AST parsing**  
   The source file is transformed into its Abstract Syntax Tree so each
   constructor call can be inspected structurally.

2. **Locate `.merge()` calls**  
  A node is considered a `merge` call when:
  • it is an `ast.Call`, and
  • the function is an attribute named `merge`, and
  • its base object is recognised as a Pandas DataFrame in the current scope.

3. **Parameter check**
    The call is flagged when it supplies exactly one argument/keyword 
    – typically the right‑hand‑side DataFrame 
    – without any of the explicit key parameters `(on, left_on, right_on)`.

4. **Reporting**  

   When such a node is found the detector emits 
   REPORT: Specify 'on' or 'left_on/right_on' when using merge() at line `n `
---



---

## Practical meaning for the developer 


Make the join columns explicit:

```python
# BEFORE – implicit & fragile
combined = orders.merge(customers)

# AFTER  – self‑documenting
combined = orders.merge(customers, on="customer_id")
# or for non‑symmetrical column names:
combined = orders.merge(df_b, left_on="user_id", right_on="id")
```


This guards against silent behaviour changes when new columns are added and
aligns the code with best practices from SQL and data‑engineering tools.

---

## Limitations  

- Only the exact attribute `.merge()` on a recognised DataFrame variable is
analysed; helper wrappers (`my_merge(df1, df2)`) are missed.

- Static analysis cannot assert that a one‑parameter merge is always wrong –
it simply warns that the intent is ambiguous.

