# Smell: DataFrame Conversion API Misused

## Motivation  

Calling `.values` on a Pandas DataFrame was convenient in the early days, but
has important drawbacks today:

It silently flattens certain extension `dtypes` (`string[pyarrow]`, `nullable
integer`, `categorical`) back to plain object or NumPy types, losing type
information.

It always returns a NumPy ndarray, making it impossible to ask for an
arrow‑backed or sparse result.

Future Pandas versions will likely deprecate `.values` in favour of the more
explicit `.to_numpy()` API (see
https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_numpy.html).

Using `df.to_numpy()` lets the developer control the dtype and backend, and
keeps the code future‑proof.

---

## Detection strategy (high‑level view)

1. **AST parsing**  
   The source file is transformed into its Abstract Syntax Tree so each
   constructor call can be inspected structurally.

2. **Locate `.values` accesses**  
  A node is flagged when:  
  • it is an `ast.Attribute` named values, and  
  • its base object is recognised as a `Pandas DataFrame` in the current scope
(leveraging the predicate `isDataFrameVariable`).

3. **Reporting**  

   When such a node is found the detector emits 
   REPORT: Avoid using .values on DataFrames. Use .to_numpy() instead at line `n `
---



---

## Practical meaning for the developer 


Replace the legacy property with the modern, explicit method:

```python
# BEFORE – legacy property
array = df.values            # dtype often downgraded to object

# AFTER  – clearer intent & options
array = df.to_numpy()        # or: df.to_numpy(dtype="float32")
```


This keeps the code explicit, future‑compatible, and preserves `dtype` control.

---

## Limitations  

- The rule only targets direct uses of `.values`; helper wrappers or
aliases (`get_numpy(df)`) are out of scope.

- DataFrames created under non‑standard aliases (my_pd.DataFrame) might be
missed by the DataFrame‑detection predicate.

- Static analysis cannot tell whether the resulting NumPy array is actually
mis‑typed elsewhere; the warning is purely preventive.
