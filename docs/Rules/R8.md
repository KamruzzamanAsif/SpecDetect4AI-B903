# Smell: “Deterministic Algorithm Option Not Used”


## Motivation  
In PyTorch the *public* way to execute a `nn.Module` is to **call the instance directly**:

```python
y = model(x)          #  recommended
```

This single line triggers:

1. All registered **forward‑pre hooks**,  
2. The user‑defined `forward()` implementation,  
3. All **forward‑post hooks** and framework wrappers (autocast, checkpointing…).

Calling the *internal* method explicitly — `model.forward(x)` — **skips** this machinery and any extra logic added by higher‑level libraries (e.g. Lightning).  
Typical side‑effects include:

* Debugging / profiling hooks not executed,  
* Gradient‑checkpointing or mixed‑precision disabled,  
* Behaviour changes when hooks are introduced later.
---

## Detection strategy (high-level view)

1. **AST parsing**  
   The source file is transformed into its Abstract Syntax Tree so each
   constructor call can be inspected structurally.

2. **Locate .forward() invocations**  
   Mark every `ast.Call` whose attribute is **`forward`**.

3. **Legitimate exceptions**  
   **Whitelist** calls that appear inside the class’s own `__call__` method – legitimate wrapper pattern.

```python
class MyWrapper(nn.Module):
    def __call__(self, x):
        # some pre-processing …
        return self.block.forward(x)   # legitimate
```


4. **Decision rule**  
   Any other .forward() call is flagged as a misuse.

5. **Reporting**
    Each offending site is reported as
REPORT: Use module() instead of forward() at line `n`
where `n` is the exact line of the bad call.

---

## Practical meaning for the developer  
Replace direct `forward()` invocations with the hook‑aware syntax:

```python
# BEFORE  – will raise the smell
out = model.forward(x)   

# AFTER   – safe and idiomatic
out = model(x)
```

This guarantees that hooks, precision wrappers and framework integrations remain functional.

## Limitations

- Only the standard method name **`forward`** is checked; custom compute methods are ignored.  
- The rule analyses a single file; a helper in another module calling `.forward()` might be missed.  
- Obfuscated calls such as `getattr(model, "forward")(x)` are not detected.